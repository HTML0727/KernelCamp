# KernelCamp 技术文档

## 🏗️ 架构概述

KernelCamp 采用分层架构设计，分为原生层和界面层：

### 原生层 (C语言)
- **内核交互模块**: 提供系统调用和内核配置访问
- **配置解析器**: 解析和处理内核配置文件
- **参数验证器**: 验证参数值的有效性

### 界面层 (C#/.NET)
- **GTK# UI框架**: 提供GNOME风格的图形界面
- **数据绑定层**: 连接原生数据和UI控件
- **业务逻辑层**: 处理用户交互和配置管理

## 🔧 核心技术

### 1. 内核版本检测
```c
char* get_kernel_version() {
    struct utsname buf;
    if (uname(&buf) == 0) {
        return strdup(buf.release);
    }
    return NULL;
}
```

### 2. 配置路径发现
支持多种配置路径：
- `/proc/config.gz` (运行时配置)
- `/boot/config-$(uname -r)` (启动配置)
- `/usr/src/linux/.config` (源码配置)

### 3. 配置解析
```c
int read_kernel_config(const char* config_path, char*** options, int* count) {
    // 处理gzip压缩和普通文本配置
    // 跳过注释和空行
    // 解析CONFIG_OPTION=value格式
}
```

### 4. 参数修改
```c
int modify_kernel_config(const char* config_path, const char* option_name, const char* new_value) {
    // 实现安全的配置修改
    // 支持y/n/m布尔值和数值参数
}
```

## 🎨 UI设计

### 主界面布局
- **信息栏**: 显示内核版本和配置路径
- **配置表格**: 树形视图显示所有配置选项
- **操作栏**: 刷新、应用、退出按钮

### 控件设计
- **TreeView**: 显示配置选项和当前值
- **CellRendererCombo**: 下拉菜单选择参数值
- **MessageDialog**: 错误和信息提示

## 📦 构建系统

### 多阶段构建
1. **原生库构建**: GCC编译C代码为共享库
2. **UI应用构建**: .NET SDK编译C#代码
3. **依赖收集**: 收集运行时依赖
4. **打包**: 创建AppImage包

### 依赖管理
- **系统依赖**: 通过包管理器安装
- **.NET依赖**: 通过NuGet管理
- **运行时依赖**: 包含在AppImage中

## 🔄 数据流

### 配置加载流程
1. 检测内核版本 → 2. 查找配置路径 → 3. 解析配置内容 → 4. 显示在UI中

### 参数修改流程
1. 用户选择参数 → 2. 验证新值 → 3. 修改配置 → 4. 应用更改

## 🛡️ 安全考虑

### 权限管理
- 配置文件读取需要适当权限
- 配置修改需要root权限
- 输入验证防止注入攻击

### 错误处理
- 完善的错误检查和恢复机制
- 用户友好的错误提示
- 日志记录用于调试

## 📊 性能优化

### 内存管理
- 及时释放原生内存
- 使用对象池减少分配
- 避免内存泄漏

### 响应性优化
- 异步加载配置
- 增量更新UI
- 缓存常用数据

## 🔍 调试支持

### 日志系统
- 分级日志输出
- 文件和控制台日志
- 运行时调试信息

### 测试工具
- 单元测试框架
- 集成测试脚本
- 性能测试套件

## 🚀 扩展性

### 插件架构
- 可扩展的参数类型
- 自定义验证规则
- 第三方模块支持

### 多平台支持
- Linux发行版适配
- 不同内核版本支持
- 硬件架构扩展

## 📋 版本策略

### 版本命名
- `0.a1`: Alpha测试版
- `0.b1`: Beta测试版  
- `1.0.0`: 稳定版

### 发布周期
- 每周开发构建
- 每月测试发布
- 季度稳定版本

---

*本文档最后更新: 2025-07-27*
*Nekosparry*
